<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with flodia • flodia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with flodia">
<meta property="og:description" content="flodia">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flodia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html">Getting started with flodia</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/flodia/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="getting_started_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with flodia</h1>
                        <h4 class="author">Lilith Whittles</h4>
            
            <h4 class="date">2021-05-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/flodia/blob/master/vignettes/getting_started.Rmd"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p><code>flodia</code> provides a framework for drawing flow diagrams in base R, aimed at anyone who is tired of messing about in powerpoint, but can’t quite bring themselves to learn tikz.</p>
<p>The basic units of a <code>flodia</code> are nodes, which can be connected in a variety of ways via flows. Complex diagrams can be built by creating and grouping sub-diagrams. This is a brief tutorial on how to use the package’s main functions to quickly create flow diagrams that are clear and easy to adapt.</p>
<p>You can see an example of a <code>flodia</code> <a href="https://github.com/mrc-ide/sircovid">here</a>.</p>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p>A <code>flodia</code> takes the format of a function, in which nodes are positioned on the (x, y) grid and connected to each other via flows. Flows proceed in either the x- or y- direction (i.e. no curves or diagonal lines). The function may take arguments if you like, but it is not necessary. The only real rule is that the function must return a list containing named elements <code>x0</code>, <code>x1</code>, <code>y0</code> and <code>y1</code>, which refer to the left-, right-, bottom- and top-most co-ordinates of the <code>flodia</code>. All <code>flodia</code> objects, either nodes or flows will return a similar list, with additional elements <code>x</code> and <code>y</code> giving the mid-point of the object. Flows additionally return their <code>from</code> and <code>to</code> nodes, as well as the co-ordinates of any turn points along the length of the flow.</p>
<p>While you can simply place nodes on the grid using their co-ordinates, it is often better to place them relative to each other, taking advantage of their output <code>x0</code>, <code>x1</code>, <code>y0</code> and <code>y1</code> co-ordinates. This will generally save you time when tweaking the <code>flodia</code>, and is invaluable when grouping together multiple diagrams, as we shall see later.</p>
<div id="example-1-simple-flow-diagram" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-simple-flow-diagram" class="anchor"></a>Example 1: Simple flow diagram</h3>
<p>The following code plots a simple flow diagram for a <a href="https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology">Susceptible-Infected-Recovered (SIR)</a> compartmental model. Demonstrating the use of relative node positioning, and the basic <code><a href="../reference/node.html">node()</a></code> and <code><a href="../reference/flow.html">flow()</a></code> functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/mrc-ide/flodia">"flodia"</a></span><span class="op">)</span>

<span class="va">sir</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># define the radius of the nodes</span>
  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
  <span class="va">xgap</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>

  <span class="co"># draw the first node at (1, 1)</span>
  <span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="st">"S"</span><span class="op">)</span>
  <span class="co"># draw the second node xgap units to the right of the first</span>
  <span class="va">I</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">x1</span> <span class="op">+</span> <span class="va">xgap</span>, y <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span>
  <span class="co"># draw the third node xgap units to the right of the second</span>
  <span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">I</span><span class="op">$</span><span class="va">x1</span> <span class="op">+</span> <span class="va">xgap</span>, y <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span>
  
  <span class="co"># connect the nodes together with flows</span>
  <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">S</span>, to <span class="op">=</span> <span class="va">I</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">I</span>, to <span class="op">=</span> <span class="va">R</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># return a list of the left, right, bottom and top co-ordinates</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">x0</span>, x1 <span class="op">=</span> <span class="va">R</span><span class="op">$</span><span class="va">x1</span>, y0 <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y0</span>, y1 <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>While you can plot the diagram interactively in the plotting device using the function <code><a href="../reference/flodia.html">flodia()</a></code>, it is often better to plot directly to png using <code><a href="../reference/flodia_png.html">flodia_png()</a></code>. This maintains the aspect ratio of the diagram, which is automatically calculated to keep the plotting grid square, and will save you time in the long run.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/flodia_png.html">flodia_png</a></span><span class="op">(</span><span class="va">sir</span>, filepath <span class="op">=</span> <span class="st">"figs/example1.png"</span>, res <span class="op">=</span> <span class="fl">250</span><span class="op">)</span>
<span class="co">#&gt; quartz_off_screen </span>
<span class="co">#&gt;                 3</span></code></pre></div>
<div class="figure">
<img src="figs/example1.png" style="width:15cm" alt=""><p class="caption">simple SIR diagram</p>
</div>
</div>
<div id="example-2-adding-more-complex-flows" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-adding-more-complex-flows" class="anchor"></a>Example 2: Adding more complex flows</h3>
<p>In addition to simple flows, <code>flodia</code> provides functions to connect two or more nodes in a few different ways: namely <code>bend</code>, <code>turn</code>, <code>split</code> and <code>fork</code>. Each of these functions comes in an -x or -y variant, depending on the direction of the flow required (e.g. <code><a href="../reference/bendx.html">bendx()</a></code> and <code><a href="../reference/bendy.html">bendy()</a></code>).</p>
<p>These can be used to create more complex diagrams, for instance, we can adapt the above SIR model by allowing an incubation period (E), <code>fork</code> the infected compartment (I) into individuals with disease (D) and those who remain asymptomatic (A), allow them to recover at different rates (by adding a <code>bend</code> into R), and incorporate waning of immunity (by adding a <code>turn</code> from R to S).</p>
<p>We can also colour the nodes according to whether they are susceptible to infection, currently infectious (or not), or immune. <code>flodia</code> includes two colour palettes <code><a href="../reference/light_palette.html">light_palette()</a></code> and <code><a href="../reference/mid_palette.html">mid_palette()</a></code> which assemble colours from fantastic <a href="https://github.com/ewenme/ghibli">ghibli palette</a>, but you can specify any colour scheme you like. There are a host of other formatting options, giving control over positioning, style and font which can be explored by reading the help functions for each type of flow.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">sedar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">S_x</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">S_y</span> <span class="op">=</span> <span class="fl">1</span>,
                 <span class="va">label</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"S"</span>, E <span class="op">=</span> <span class="st">"E"</span>, D <span class="op">=</span> <span class="st">"D"</span>, A <span class="op">=</span> <span class="st">"A"</span>, R <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span>,
                 <span class="va">RS_pos</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># define the radius of the nodes</span>
  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
  <span class="va">xgap</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>
  <span class="va">ygap</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>
  
  <span class="co"># specify colours for the nodes</span>
  <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fu"><a href="../reference/light_palette.html">light_palette</a></span><span class="op">(</span><span class="st">"gnbu"</span><span class="op">)</span>,
              E <span class="op">=</span> <span class="fu"><a href="../reference/light_palette.html">light_palette</a></span><span class="op">(</span><span class="st">"rdor"</span><span class="op">)</span>,
              I <span class="op">=</span> <span class="fu"><a href="../reference/light_palette.html">light_palette</a></span><span class="op">(</span><span class="st">"ylgn"</span><span class="op">)</span>,
              R <span class="op">=</span> <span class="fu"><a href="../reference/light_palette.html">light_palette</a></span><span class="op">(</span><span class="st">"bupu"</span><span class="op">)</span><span class="op">)</span>
  

  <span class="co"># draw S at (S_x, S_y)</span>
  <span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">S_x</span>, y <span class="op">=</span> <span class="va">S_y</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">$</span><span class="va">S</span>, node_col <span class="op">=</span> <span class="va">col</span><span class="op">$</span><span class="va">S</span><span class="op">)</span>
  <span class="co"># draw E xgap units to the right of </span>
  <span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">x1</span> <span class="op">+</span> <span class="va">xgap</span>, y <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">$</span><span class="va">E</span>, node_col <span class="op">=</span> <span class="va">col</span><span class="op">$</span><span class="va">E</span><span class="op">)</span>
  <span class="co"># draw D 1.5 * xgap units to the right, and ygap units above E</span>
  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">E</span><span class="op">$</span><span class="va">x1</span> <span class="op">+</span> <span class="va">xgap</span> <span class="op">*</span> <span class="fl">1.8</span>, y <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="va">ygap</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">$</span><span class="va">D</span>,
            node_col <span class="op">=</span> <span class="va">col</span><span class="op">$</span><span class="va">I</span><span class="op">)</span>
  <span class="co"># draw A at the same x-coordinate as d, and ygap units below E</span>
  <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">ygap</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">$</span><span class="va">A</span>, node_col <span class="op">=</span> <span class="va">col</span><span class="op">$</span><span class="va">I</span><span class="op">)</span>
  <span class="co"># draw R xgap units to the right of A and D</span>
  <span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/node.html">node</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">x1</span> <span class="op">+</span> <span class="va">xgap</span>, y <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">y</span>, r <span class="op">=</span> <span class="va">r</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">$</span><span class="va">R</span>, node_col <span class="op">=</span> <span class="va">col</span><span class="op">$</span><span class="va">R</span><span class="op">)</span>
  
  <span class="co"># add flows</span>
  <span class="co"># connect S to E</span>
  <span class="fu"><a href="../reference/flowx.html">flowx</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">S</span>, to <span class="op">=</span> <span class="va">E</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># connect S to A and D</span>
  <span class="fu"><a href="../reference/forkx.html">forkx</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">E</span>, to0 <span class="op">=</span> <span class="va">A</span>, to1 <span class="op">=</span> <span class="va">D</span>, label_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">[</span><span class="va">E</span><span class="op">]</span><span class="op">)</span>,
        label_to0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">[</span><span class="va">D</span><span class="op">]</span><span class="op">)</span>,
        label_to1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">D</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># connect D to R</span>
  <span class="fu"><a href="../reference/bendy.html">bendy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">D</span>, to <span class="op">=</span> <span class="va">R</span>, pos_to <span class="op">=</span> <span class="fl">0.7</span>,
        label_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">[</span><span class="va">D</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># connect A to R</span>
  <span class="fu"><a href="../reference/bendy.html">bendy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">A</span>, to <span class="op">=</span> <span class="va">R</span>, pos_to <span class="op">=</span> <span class="fl">0.3</span>,
        label_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">[</span><span class="va">A</span><span class="op">]</span><span class="op">)</span>,
        label_to_gap <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span><span class="op">)</span>
  <span class="co"># connect R to S - record co-ordinates in object rs as this turn extends the</span>
  <span class="co"># top of the flodia (y1) so must be output</span>
  <span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/turny.html">turny</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">R</span>, mid_y <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">y1</span> <span class="op">+</span> <span class="fl">0.05</span>, to <span class="op">=</span> <span class="va">S</span>,
              label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">[</span><span class="va">R</span><span class="op">]</span><span class="op">)</span>, pos_to <span class="op">=</span> <span class="va">RS_pos</span><span class="op">)</span>

  
  <span class="co"># return a list of the left, right, bottom and top co-ordinates</span>
  <span class="co"># additionally return node S co-ordinates</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">S</span><span class="op">$</span><span class="va">x0</span>, x1 <span class="op">=</span> <span class="va">R</span><span class="op">$</span><span class="va">x1</span>, y0 <span class="op">=</span> <span class="va">A</span><span class="op">$</span><span class="va">y0</span>, y1 <span class="op">=</span> <span class="va">rs</span><span class="op">$</span><span class="va">y1</span>, S <span class="op">=</span> <span class="va">S</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/flodia_png.html">flodia_png</a></span><span class="op">(</span><span class="va">sedar</span>, filepath <span class="op">=</span> <span class="st">"figs/example2.png"</span>, res <span class="op">=</span> <span class="fl">250</span><span class="op">)</span>
<span class="co">#&gt; quartz_off_screen </span>
<span class="co">#&gt;                 3</span></code></pre></div>
<div class="figure">
<img src="figs/example2.png" style="width:15cm" alt=""><p class="caption">Colour-coded SEIRS diagram with disease and asymptomatic carriage</p>
</div>
</div>
<div id="example-3-grouping-nodes" class="section level3">
<h3 class="hasAnchor">
<a href="#example-3-grouping-nodes" class="anchor"></a>Example 3: Grouping nodes</h3>
<p>It is often useful to group nodes together, we can simplify a diagram by using a single flow to represent a process affecting a group of nodes, rather than individual flows from each. Flodia allows for flows into or out of a diagram (i.e. only connected to a node at one end), via an optional <code>length</code> argument to <code><a href="../reference/flowx.html">flowx()</a></code>, <code><a href="../reference/flowy.html">flowy()</a></code>, <code><a href="../reference/forkx.html">forkx()</a></code>, <code><a href="../reference/forky.html">forky()</a></code>, <code><a href="../reference/splitx.html">splitx()</a></code>, and <code><a href="../reference/splity.html">splity()</a></code>.</p>
<p>To continue our previous example, we may for instance want to allow for demographic changes in our model of disease transmission. Individuals are born susceptible to infection, but may die in any stage of infection. While we could add flows out of each compartment to represent deaths, this would quickly become messy, so we instead group the nodes together, and add a flow out of the group.</p>
<p>You may have noticed that we included the node “S” in the list returned by the function in Example 2. By outputting a node we are able to flow directly into it, regardless of whether it is part of a group.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sedar_group</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">S_x</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">S_y</span> <span class="op">=</span> <span class="fl">1</span>,
                 <span class="va">label</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"S"</span>, E <span class="op">=</span> <span class="st">"E"</span>, D <span class="op">=</span> <span class="st">"D"</span>, A <span class="op">=</span> <span class="st">"A"</span>, R <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span>,
                 <span class="va">RS_pos</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># group the nodes together</span>
  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group.html">group</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">sedar</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>S_x <span class="op">=</span> <span class="va">S_x</span>, S_y <span class="op">=</span> <span class="va">S_y</span>, label <span class="op">=</span> <span class="va">label</span>,
                                    RS_pos <span class="op">=</span> <span class="va">RS_pos</span><span class="op">)</span>,
             group_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>, oma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># specify length of inflow and outflow</span>
  <span class="va">l</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>

  <span class="co"># births into S</span>
  <span class="va">births</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flowx.html">flowx</a></span><span class="op">(</span>to <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">S</span>, length <span class="op">=</span> <span class="va">l</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, label_pos <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>
  <span class="co"># deaths out of group</span>
  <span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flowx.html">flowx</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">g</span>, length <span class="op">=</span> <span class="va">l</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># return a list of the left, right, bottom and top co-ordinates, and node S</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">births</span><span class="op">$</span><span class="va">x0</span>, x1 <span class="op">=</span> <span class="va">deaths</span><span class="op">$</span><span class="va">x1</span>, y0 <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">y0</span>, y1 <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">y1</span>, S <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">S</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/flodia_png.html">flodia_png</a></span><span class="op">(</span><span class="va">sedar_group</span>, filepath <span class="op">=</span> <span class="st">"figs/example3.png"</span>, res <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>
<span class="co">#&gt; quartz_off_screen </span>
<span class="co">#&gt;                 3</span></code></pre></div>
<div class="figure">
<img src="figs/example3.png" style="width:15cm" alt=""><p class="caption">Colour-coded SEIRS diagram with disease and asymptomatic carriage and demography</p>
</div>
</div>
<div id="example-4-combining-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#example-4-combining-groups" class="anchor"></a>Example 4: Combining groups</h3>
<p>When we want to produce multiple sub-diagrams it is often easiest to provide arguments representing the differences between the sub-diagrams to a flodia function. You may have noticed that we provided optional arguments to the functions in Examples 2 and 3, which we have not yet used (but will now come in handy), specifying the x and y co-ordinates of the “S” node, as well as the node labels.</p>
<p>To continue our previous example of a model of infectious disease, we may want to allow for the possibility of vaccination for susceptible (S) individuals in our SEIRS model diagram. If the vaccine does not provide perfect protection, then we need to mirror the infection process in the vaccinated nodes, which means repeating a grouped sub-diagram. Additionally the vaccine may wane after a time, so we need to flow back from the vaccinated to unvaccinated group.</p>
<p>This can be accomplished by calling our previously written function from Example 3, but providing different arguments to represent the mirrored unvaccinated and vaccinated groups. Here we give nodes in the vaccinated group the superscript *, and use the argument governing the co-ordinates of “S” to position the vaccinated group relative to the unvaccinated group. We can then use flows to connect the groups, and nodes within them (as long as we have passed the required nodes out of the grouping functions, as we have made sure to do here).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vax</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">labels_U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"S"</span>, E <span class="op">=</span> <span class="st">"E"</span>, D <span class="op">=</span> <span class="st">"D"</span>, A <span class="op">=</span> <span class="st">"A"</span>, R <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span>
  <span class="va">labels_V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%s*"</span>, <span class="va">labels_U</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">labels_V</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">labels_U</span>

  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu">sedar_group</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">labels_U</span><span class="op">)</span><span class="op">)</span>
  <span class="va">V</span> <span class="op">&lt;-</span> <span class="fu">sedar_group</span><span class="op">(</span>S_y <span class="op">=</span> <span class="va">U</span><span class="op">$</span><span class="va">y0</span> <span class="op">-</span> <span class="fl">0.8</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">labels_V</span><span class="op">)</span>, RS_pos <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>
  
  <span class="co"># add vaccination flow - aligning label between U and V</span>
  <span class="fu"><a href="../reference/flowy.html">flowy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">U</span><span class="op">$</span><span class="va">S</span>, to <span class="op">=</span> <span class="va">V</span><span class="op">$</span><span class="va">S</span>, pos <span class="op">=</span> <span class="fl">0.5</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">nu</span><span class="op">)</span>,
        label_y <span class="op">=</span> <span class="fu"><a href="../reference/calc_pos.html">calc_pos</a></span><span class="op">(</span><span class="va">U</span><span class="op">$</span><span class="va">y0</span>, <span class="va">V</span><span class="op">$</span><span class="va">y1</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># add waning flow</span>
  <span class="fu"><a href="../reference/flowy.html">flowy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">V</span>, to <span class="op">=</span> <span class="va">U</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">omega</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># return a list of the left, right, bottom and top co-ordinates</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">U</span><span class="op">$</span><span class="va">x0</span>, x1 <span class="op">=</span> <span class="va">U</span><span class="op">$</span><span class="va">x1</span>, y0 <span class="op">=</span> <span class="va">V</span><span class="op">$</span><span class="va">y0</span>, y1 <span class="op">=</span> <span class="va">U</span><span class="op">$</span><span class="va">y1</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/flodia_png.html">flodia_png</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">vax</span>, filepath <span class="op">=</span> <span class="st">"figs/example4.png"</span>, res <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>
<span class="co">#&gt; quartz_off_screen </span>
<span class="co">#&gt;                 3</span></code></pre></div>
<div class="figure">
<img src="figs/example4.png" style="width:15cm" alt=""><p class="caption">SEIRS with demography and vaccination</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lilith Whittles.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
